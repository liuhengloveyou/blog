---
title: 分布式系统总结
comments: true
date: 2017-11-20 16:52:41
time: 1511167961
categories: 分布式
---

## 什么是分布式系统

> 各种文献对分布式系统有各种定义

- **分布式系统**是若干独立计算机的集合，这些计算机对于用户来说就像就像是单个相关系统。
  在硬件方面，机器本身是独立的；在软件方面，对用户来说就像是在与单个系统打交道。两方面共同阐明了分布式系统的定义，缺一不同。—《分布式系统原理和范型》
- 从进程角度看，两个程序进程分别运行在两台主机上，它们通过socket通信，相互协作最终完成同一个服务或功能。那么理论上这两个程序所组成的系统可以称作是**分布式系统**。—比较直白的定义
- **分布式网络**的计算机中的组件之间协调动作是通过消息进行通讯。— Anderw S.Tanenbaum
- **分布式系统**是这样系统：旨在支持应用程序和服务的开发，可以利用物理架构 由多个自治的处理元素，不共享主内存，但通过网络发送异步消息合作。— Leslie Lamport
- 当你知道有一台电脑崩溃，但是你的软件运行从来不会停止。— G. Coulouris
- 整个系统间拥有一个以上的时序即为**分布式系统**。— 另一个定义


## 分布式系统的特点

- 高可用/高可靠。

  - 可用是指可以在用户可容忍的时限内向用户提供正确服务。
  - 可用性一般公式：Availability = uptime / (uptime + downtime)

  分布式系统的高可用性表现在，整个系统在有单机或间个服务发生错误的情况下，仍然能够正常服务或有损服务。

- 高并发/高吞吐。

- 高可扩展/高伸缩。


## CAP定理

### 名词解释：

**Consistency(一致性)**

> 在分布式系统中的所有数据备份，在同一时刻是否同样的值。（等同于所有节点访问同一份最新的数据副本）

**Availability(可用性)**

> 在集群中一部分节点故障后，集群整体是否还能响应客户端的读写请求。（对数据更新具备高可用性）

**Partition tolerance(分区可容忍性)**

> 以实际效果而言，分区相当于对通信的时限要求。系统如果不能在时限内达成数据一致性，就意味着发生了分区的情况，必须就当前操作在C和A之间做出选择。

### 经典的或者说不太精确的认识：

**定理**：任何分布式系统只可同时满足二点，没法三者兼顾。
**忠告**：架构师不要将精力浪费在如何设计能满足三者的完美分布式系统，而是应该进行取舍。

### CAP的决择

- CA：如果不要求P（不允许分区），则C（强一致性）和A（可用性）是可以保证的。但其实分区不是你想不想的问题，而是始终会存在，因此CA的系统更多的是允许分区后各子系统依然保持CA。
- CP：如果不要求A（可用），相当于每个请求都需要在Server之间强一致，而P（分区）会导致同步时间无限延长，如此CP也是可以保证的。很多传统的数据库分布式事务都属于这种模式。
- AP：要高可用并允许分区，则需放弃一致性。一旦分区发生，节点之间可能会失去联系，为了高可用，每个节点只能用本地数据提供服务，而这样会导致全局数据的不一致性。现在众多的NoSQL都属于此类。

CAP理论就是说在分布式存储系统中，最多只能实现其中的两点。而由于当前的网络硬件肯定会出现延迟丢包等问题，所以**分区容忍性是我们必须需要实现的**。

所以我们只能在**C(一致性)**和**A(可用性)**之间进行权衡。



## BASE

BASE模型反ACID模型，完全不同ACID模型，牺牲高一致性，获得可用性或可靠性。

**Basically Available**基本可用，支持分区失败(e.g. sharding碎片划分数据库)
**Soft state**软状态，状态可以有一段时间不一致，异步。
**Eventually consistent**最终一致，最终数据是一致的就可以了，而不是时时高一致。



## Raft

## 分布式系统的挑战

- 异构性：分布式系统由于基于不同的网络、操作系统、计算机硬件和编程语言来构造，必须要考虑一种通用的网络通信协议来屏蔽异构系统之间的差异。一般交由中间件来处理这些差异。
- 缺乏全球时钟：在程序需要协作时，它们通过交换消息来协调它们的动作。紧密的协调经常依赖于对程序动作发生时间的共识，但是，实际上网络上计算机同步时钟的准确性受到极大的限制，即没有一个正确时间的全局概念。这是通过网络发送消息作为唯一的通信方式这一事实带来的直接结果。
- 一致性：数据被分散或者复制到不同的机器上，如何保证各台主机之间的数据的一致性将成为一个难点。
- 故障的独立性：任何计算机都有可能故障，且各种故障不尽相同。他们之间出现故障的时机也是相互独立的。一般分布式系统要设计成被允许出现部分故障而不影响整个系统的正常使用。
- 并发：分布式系统的目的，是为了更好的共享资源。那么系统中的每个资源都必须被设计成在并发环境中是安全的。
- 透明性：分布式系统中任何组件的故障、或者主机的升级、迁移对于用户来说都是透明的，不可见的。
- 开放性：分布式系统由不同的程序员来编写不同的组件，组件最终要集成成为一个系统，那么组件所发布的接口必须遵守一定的规范且能够被互相理解。
- 安全性：加密用于给共享资源提供适当的保护，在网络上所有传递的敏感信息，都需要进行加密。拒绝服务攻击仍然是一个有待解决的问题。
- 可扩展性：系统要设计成随着业务量的增加，相应的系统也必须要能扩展来提供对应的服务。



## 高可用方案

## 高并发方案

## 高可用方案



## 如何架构分布式系统

### SOA

### 微服务



## 分布式系统领域里一些重要的东西

1. Paxos 是分布式系统里一个重要而且实用的技术。
2. Consistent Hash 也是分布式系统里一个重要而且实用的技术。
3. MapReduce, Spark 等等都是很实用的系统。
4. ​

## 如何来设计分

概况起来，在设计分布式系统时，应考虑以下几个问题：

- 系统如何拆分为子系统？
- 如何规划子系统间的通信？
- 通信过程中的安全如何考虑？
- 如何让子系统可以扩展？
- 子系统的可靠性如何保证？
- 数据的一致性是如何实现的？

## 原理理论

> ### [分布式网络是否可靠?](http://www.jdon.com/45519)
>
> ### [分布式系统Paxos算法](http://www.jdon.com/artichect/paxos.html)
>
> ### [分布式系统Raft算法](http://www.jdon.com/artichect/raft.html)
>
> ### [CAP原理和BASE思想](http://www.jdon.com/37625)
>
> ### [如何打败CAP定理？](http://www.jdon.com/42886)
>
> ### [如何正确理解CAP理论？](http://www.jdon.com/bigdata/how-to-understand-cap.html)
>
> ### [CAP理论以及Eventually Consistent （最终一致性）解析](http://www.jdon.com/37999)
>
> ### [弱一致性在现实世界中到处存在](http://www.jdon.com/43246)
>
> [最终一致性其实比MVCC简单](http://www.jdon.com/46910)
>
> [ACID中C与CAP定理中C的区别](http://www.jdon.com/46956)
>
> ### [线性化与串行化比较](http://www.jdon.com/artichect/linearizability-versus-serializability.html)
>
> ### [一致性、可用性和收敛性(CAC)](http://www.jdon.com/artichect/consistency-availability-and-convergence.html)
>
> ### [分布式系统因果一致性与COPS算法](http://www.jdon.com/artichect/cops.html)
>
> ### [分布式CRDT模型 ](http://www.jdon.com/artichect/crdt.html)
>
> ### [In-Stream大数据处理模式](http://www.jdon.com/45698)
>
> ### [更多分布式系统讨论](http://www.jdon.com/tags/212)

 

## 实践方案

> ### [日志是每个软件工程师关心的统一数据抽象](http://www.jdon.com/bigdata/log.html)
>
> ### [使用Docker建立一个动态负载平衡的分布式Web系统 ](http://www.jdon.com/46580)
>
> ### [Docker容器化组件架构 ](http://www.jdon.com/artichect/docker-containerization.html)
>
> ### [使用Mesos和Marathon管理Docker集群](http://www.jdon.com/artichect/managing-docker-clusters-using-mesos-and-marathon.html)
>
> ### [Kubernetes简单介绍](http://www.jdon.com/artichect/kubernetes.html)
>
> ### [ZooKeeper在服务发现中应用](http://www.jdon.com/artichect/zookeeper.html)
>
> ### [Ebay架构特点(HPTS 2009](http://www.jdon.com/37753)
>
> ### [FaceBook架构](http://www.jdon.com/artichect/facebook.html)
>
> ### [LinkedIn架构](http://www.jdon.com/artichect/linkedin.html)
>
> ### [Twitter架构](http://www.jdon.com/artichect/twitter.html)
>
> ### [Netflix架构](http://www.jdon.com/artichect/netflix.html)
>
> ### [淘宝数据魔方的系统架构](http://www.jdon.com/artichect/taobaodatagrid.html)

 

## 分布式存储

> ### [Nosql概述介绍](http://www.jdon.com/repository/nosql-databases-overview.html)
>
> ### [苹果为什么购买FoundationDB?](http://www.jdon.com/47196) 
>
> ### [NOSQL专题](http://www.jdon.com/nosql.html)(几十篇)
>
> ### [缓存专题](http://www.jdon.com/cache.html)(几十篇)

 

## 分布式计算

> ### [CQRS专题](http://www.jdon.com/cqrs.html)
>
> ### [云计算专题](http://www.jdon.com/cloudcompute.html)
>
> ### [EJB专题](http://www.jdon.com/tags/406)
>
> ### [集群cluster](http://www.jdon.com/tags/214)
>
> ### [Hadoop分布式计算](http://www.jdon.com/bigdata/hadoop.html)(原理与安装案例)
>
> ### [Storm分布式实时计算](http://www.jdon.com/bigdata/storm.html)
